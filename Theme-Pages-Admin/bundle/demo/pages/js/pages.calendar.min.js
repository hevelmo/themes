!function($){"use strict";$.fn.pagescalendar=function(method){var content,daysOfMonth,cellHeight,methods={init:function(options){return this.pagescalendar.settings=$.extend({},this.pagescalendar.defaults,options),this.each(function(){$(this)})},today:function(){helpers.today()},next:function(){helpers.nextMonth()},prev:function(){helpers.previousMonth()},setDate:function(date){helpers.setDate(date)},getDate:function(format){return helpers.getDate(format)},render:function(){helpers.checkOptionsAndBuild()},destroy:function(){},setLocale:function(lang){settings.locale=lang,helpers.setLocale()},reloadEvents:function(){helpers.loadEvents()},addEvent:function(event){helpers.addEvent(event)},removeEvent:function(index){helpers.deleteEvent(index)},updateEvent:function(index,eventObj){helpers.updateEvent(index,eventObj)},getEvents:function(option){return helpers.getEventArray(option)}},settings=$.fn.pagescalendar.settings,calendar=(settings.timeFormat,$.fn.pagescalendar.defaults.calendar),helpers={checkOptionsAndBuild:function(){(null==settings.ui.year||null==settings.ui.month||null==settings.ui.date||null==settings.ui.week||null==settings.ui.grid)&&alert("You have not included the proper ui[] settings, please refer docs"),this.setLocale(),calendar.monthLong=moment().format(settings.ui.month.format),null!=settings.now?(calendar.month=moment($.fn.pagescalendar.settings.now).month(),calendar.year=moment($.fn.pagescalendar.settings.now).year(),calendar.date=moment($.fn.pagescalendar.settings.now).format("D"),calendar.dayOfWeek=moment($.fn.pagescalendar.settings.now).day(),calendar.monthLong=moment($.fn.pagescalendar.settings.now).format("MMM")):(calendar.month=moment().month(),calendar.year=moment().year(),calendar.date=moment().format("D"),calendar.dayOfWeek=moment().day(),calendar.monthLong=moment().format("MMM")),this.buildYears(),this.buildMonths(),this.buildCurrentDateHeader(),this.buildWeek(),this.buildWeekViewCalendar(),this.buildTimeSlots(),this.loadDatesToWeekView(),this.highlightActiveDay(),$.fn.pagescalendar.settings.onViewRenderComplete.call(this),this.bindEventHanders(),this.loadEvents(),this.setEventBubbles(settings.events),this.autoFocusActiveElement(),helpers.scrollToElement("#weeks-wrapper .active")},buildYears:function(){var container="#years";$(container).html(""),content="";var diffYears=settings.ui.year.endYear-settings.ui.year.startYear;diffYears=diffYears>90?90:diffYears;for(var yearInc=settings.ui.year.startYear,i=1;diffYears>=i;i++){yearInc=moment(yearInc,settings.ui.year.format).add(1,"year").format(settings.ui.year.format);var activeClass=calendar.year==yearInc?"active":"";content+='<div class="year">',content+='<a href="#" class="year-selector '+activeClass+'" data-year='+yearInc+">"+yearInc+"</a>",content+="</div>"}$(container).append(content),this.dragHandler("years")},buildMonths:function(){var container="#months";$(container).html(""),content="";for(var monthInc=moment(moment().startOf("year"),"MMMM").format(settings.ui.month.format),i=1;12>=i;i++){var activeClass=moment([calendar.year,calendar.month,calendar.date]).format(settings.ui.month.format)==monthInc?"active":"";content+='<div class="month">',content+='<a href="#" class="month-selector '+activeClass+'" data-month="'+monthInc+'">'+monthInc+"</a>",content+="</div>",monthInc=moment(monthInc,settings.ui.month.format).add(1,"month").format(settings.ui.month.format)}$(container).append(content),this.dragHandler("months")},highlightMonth:function(){$(".month a").removeClass("active"),$(".month:nth-child("+(parseInt(calendar.month)+1)+") > a").addClass("active")},highlightYear:function(){var diff=calendar.year-settings.ui.year.startYear;$(".year a").removeClass("active"),$(".year:nth-child("+diff+") > a").addClass("active")},buildCurrentDateHeader:function(){$("#currentDate").text(moment([calendar.year,calendar.month,calendar.date]).format(settings.ui.date.format))},dragHandler:function(element){if(!$("body").hasClass("mobile")&&1==$("#"+element).length){$(".drager").scrollbar();var inverseX,myElement=document.getElementById(element),hammertime=new Hammer(myElement),element=$("#"+element).parent(),lP=element.scrollLeft();hammertime.on("panmove",function(ev){inverseX=-ev.deltaX,element.scrollLeft(inverseX+lP)}),hammertime.on("panend pancancel",function(){lP=element.scrollLeft()})}},autoFocusActiveElement:function(){var timer;$(window).resize(function(){clearTimeout(timer),timer=setTimeout(function(){helpers.scrollToElement("#weeks-wrapper .active")},500)})},scrollToElement:function(el){if(el=$(el),0==!el.length){var par=$(el).parent(),t=helpers.isElementInViewport(el);if(!t){var offset,elOffset=el.offset().left,elHeight=par.children().width(),windowHeight=$(window).width();offset=windowHeight>elHeight?elOffset-(windowHeight/2-elHeight/2):elOffset,$("#weeks-wrapper").parent().animate({scrollLeft:offset},10)}}},isElementInViewport:function(el){"function"==typeof jQuery&&el instanceof jQuery&&(el=el[0]);var rect=el.getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)},buildWeek:function(){var container=".weeks-wrapper";$(container).html(""),daysOfMonth=moment([calendar.year,calendar.month]).daysInMonth(),content="";for(var i=1;daysOfMonth>=i;i++){var t=moment([calendar.year,calendar.month,i]).format("ddd"),activeClass=calendar.date==i?"active current-date":"";t==moment(settings.ui.week.startOfTheWeek,"d").format("ddd")||1==i?content+='<div class="week '+activeClass+'">':"",content+='<div class="day-wrapper date-selector">',content+='<div class="week-day">',content+='<div class="day week-header">'+moment([calendar.year,calendar.month,i]).format("dd")+"</div>",content+="</div>",content+='<div class="week-date '+activeClass+'">',content+='<div class="day"><a href="#" data-date='+moment([calendar.year,calendar.month,i]).format("D")+">"+i+"</a></div>",content+="</div>",content+="</div>",t==moment(settings.ui.week.endOfTheWeek,"d").format("ddd")?content+="</div>":""}content+="</div>",$(container).append(content),$(".weeks-wrapper .week .day-wrapper .week-date.active").closest(".week").addClass("active"),this.dragHandler("weeks-wrapper")},highlightWeek:function(elem){$(".week").removeClass("active"),$(elem).closest(".week").addClass("active")},setEventBubbles:function(eventArray){$(".has-event").removeClass("has-event"),$("#weekViewTableHead .event-bubble").remove();for(var item in eventArray){var eventYear=moment(eventArray[item].start).format(settings.ui.year.format),eventMonth=moment(eventArray[item].start).format(settings.ui.month.format),eventDate=moment(eventArray[item].start).format("D");if($('.year > [data-year="'+eventYear+'"]').addClass("has-event"),calendar.year==moment(eventArray[item].start).format("YYYY")&&($('.month > [data-month="'+eventMonth+'"]').addClass("has-event"),calendar.month+1==moment(eventArray[item].start).format("M"))){$('.date-selector > .week-date > .day > [data-date="'+eventDate+'"]').addClass("has-event");var toheaderDate=moment(eventArray[item].start).format("YYYY-MM-DD"),headerDate=$("#weekViewTableHead").find('.thead > [data-day="'+toheaderDate+'"]');null!=eventArray[item]["class"]&&0!=headerDate.length&&0==headerDate.children("."+eventArray[item]["class"]).length&&headerDate.append('<div class="event-bubble '+eventArray[item]["class"]+'"></div>')}}},buildWeekViewCalendar:function(){var numberOfCells=7,headerContent='<div class="thead" ><div class="tcell"></div><div class="tcell"></div><div class="tcell"></div><div class="tcell"></div><div class="tcell"></div><div class="tcell"></div><div class="tcell"></div></div>';window.innerWidth<=1024&&(numberOfCells=1,headerContent='<div class="thead" ><div class="tcell"></div></div>');var container=".calendar-container";$(container).html(""),content="",content+='<div class="week-view">',content+='<div class="allday-cell">',content+="</div>",content+='<div class="tble" id="weekViewTableHead">',content+=headerContent,content+="</div>",content+='<div class="grid">',content+='<div class="time-slot-wrapper" id="time-slots">',content+="</div>",content+='<div class="tble" id="weekGrid">';for(var i=1;24>=i;i++){content+='<div class="trow" >';for(var j=1;numberOfCells>=j;j++)content+='<div class="tcell">',"30"==settings.slotDuration?(content+='<div class="cell-inner" data-time-slot="'+(i-1)+':00" ></div>',content+='<div class="cell-inner" data-time-slot='+(i-1)+':30" ></div>'):content+='<div class="cell-inner" data-time-slot="'+(i-1)+':00" ></div>',content+="</div>";content+="</div>"}content+="</div>",content+="</div>",content+="</div>",$(container).append(content),cellHeight=$(".tcell").innerHeight(),calendar.startOfWeekDate=moment([calendar.year,calendar.month,calendar.date]).startOf("week"),calendar.endOfWeek=moment([calendar.year,calendar.month,calendar.date]).endOf("week").format("D")},buildTimeSlots:function(){var container="#time-slots";content="";for(var i=0;24>i;i++)content+='<div class="time-slot"><span>'+moment().hour(i).format(settings.ui.grid.timeFormat)+"</span></div>";$(container).append(content)},loadDatesToWeekView:function(){if(window.innerWidth<=1024){var d=moment([calendar.year,calendar.month,calendar.date]);return void $("#weekViewTableHead").find(".thead .tcell:nth-child(1)").html('<div class="weekdate">'+moment(d).format("D")+'</div><div class="weekday">'+moment(d).format("dddd")+"</div>").attr("data-day",moment(d).format("YYYY-MM-DD"))}var startOfWeek,endOfWeek;startOfWeek=moment([calendar.year,calendar.month,calendar.date]).startOf("week"),endOfWeek=moment([calendar.year,calendar.month,calendar.date]),$("#weekViewTableHead").find(".thead .tcell:nth-child(1)").html('<div class="weekdate">'+moment(startOfWeek).format("D")+'</div><div class="weekday">'+moment(startOfWeek).format("dddd")+"</div>").attr("data-day",moment(startOfWeek).format("YYYY-MM-DD"));for(var i=2;7>=i;i++)startOfWeek=moment(startOfWeek).add(1,"days"),$("#weekViewTableHead").find(".thead .tcell:nth-child("+i+")").html('<div class="weekdate">'+moment(startOfWeek).format("D")+'</div><div class="weekday">'+moment(startOfWeek).format("dddd")+"</div>").attr("data-day",moment(startOfWeek).format("YYYY-MM-DD"));calendar.startOfWeekDate=moment([calendar.year,calendar.month,calendar.date]).startOf("week")},highlightActiveDay:function(){$("#weekViewTableHead").find(".thead .tcell").removeClass("active"),$("#weekGrid").find(".trow .tcell").removeClass("active");var d=moment([calendar.year,calendar.month,calendar.date]).day();$("#weekViewTableHead").find(".thead .tcell:nth-child("+(d+1)+")").addClass("active"),$("#weekGrid").find(".trow .tcell:nth-child("+(d+1)+")").addClass("active")},nextMonth:function(){currentYear=moment([calendar.year,calendar.month,calendar.date]).add(1,"months").year(),currentMonth=moment([calendar.year,calendar.month,calendar.date]).add(1,"months").month(),this.setHeaderDate(),this.buildMiniCalender(),this.loadDatesToWeekView(),this.highlightActiveDay(),this.loadEvents()},previousMonth:function(){currentYear=moment([calendar.year,calendar.month,calendar.date]).subtract(1,"months").year(),currentMonth=moment([calendar.year,calendar.month,calendar.date]).subtract(1,"months").month(),this.setHeaderDate(),this.buildMiniCalender(),this.loadDatesToWeekView(),this.highlightActiveDay(),this.loadEvents()},today:function(){calendar.year=moment().year(),calendar.month=moment().month(),calendar.date=moment().format("D"),this.setHeaderDate(),this.buildMiniCalender(),this.highlightWeek(),this.loadDatesToWeekView(),this.highlightActiveDay()},addEvent:function(event){settings.events.push(event),this.loadEvents()},deleteEvent:function(index){settings.events.splice(parseInt(index),1),this.loadEvents()},updateEvent:function(index,eventObj){settings.events[index]=eventObj,this.loadEvents()},loadEvents:function(){if($("#weekGrid").find(".trow .tcell").children(".cell-inner").html(""),window.innerWidth<=1024){for(var i=0;i<settings.events.length;i++){var eventStartDate=moment(settings.events[i].start).format("YYYY-MM-DD"),currentD=moment([calendar.year,calendar.month,calendar.date]).format("YYYY-MM-DD");if(0==currentD.localeCompare(eventStartDate)){var eventEndHours,evenEndMins,cellNo=0,eventStartHours=moment(settings.events[i].start).format("H"),eventStartMins=moment(settings.events[i].start).format("m");null==settings.events[i].end?(eventEndHours=parseInt(eventStartHours)+1,evenEndMins="0"):(eventEndHours=moment(settings.events[i].end).format("H"),evenEndMins=moment(settings.events[i].end).format("m"));var eventDuration=moment(eventEndHours+":"+evenEndMins,"h:mm").diff(moment(eventStartHours+":"+eventStartMins,"h:mm"),"hours",!0);this.drawEvent(eventStartHours,eventStartMins,eventEndHours,evenEndMins,cellNo,i,eventDuration)}}return void this.setEventBubbles(settings.events)}for(var i=0;i<settings.events.length;i++){null==settings.events[i].start&&console.error("Pages Calendar : Undefined Event Start Time at Index "+i);var eventStartDate=moment(settings.events[i].start).format("YYYY-MM-DD"),currentWeekStart=moment([calendar.year,calendar.month,calendar.date]).startOf("week").format("YYYY-MM-DD"),eventWeekStart=moment(settings.events[i].start).startOf("week").format("YYYY-MM-DD");if(0==currentWeekStart.localeCompare(eventWeekStart)){var eventEndHours,evenEndMins,cellNo=moment(eventStartDate).day(),eventStartHours=moment(settings.events[i].start).format("H"),eventStartMins=moment(settings.events[i].start).format("m");null==settings.events[i].end?(eventEndHours=parseInt(eventStartHours)+1,evenEndMins="0"):(eventEndHours=moment(settings.events[i].end).format("H"),evenEndMins=moment(settings.events[i].end).format("m"));var eventDuration=moment(eventEndHours+":"+evenEndMins,"h:mm").diff(moment(eventStartHours+":"+eventStartMins,"h:mm"),"hours",!0);this.drawEvent(eventStartHours,eventStartMins,eventEndHours,evenEndMins,cellNo,i,eventDuration)}}this.setEventBubbles(settings.events)},drawEvent:function(eventStartHours,eventStartMins,eventEndHours,evenEndMins,cellNo,arrayIndex,eventDuration){cellHeight=$(".tcell").innerHeight(),evenEndMins=parseInt(evenEndMins);var cell,height,container=$("#weekGrid"),row=container.find(".trow:nth-child("+(parseInt(eventStartHours)+1)+")");if(height=cellHeight,"30"==settings.slotDuration&&(height=2*height),"30"==settings.slotDuration){parseInt(eventStartMins)>=30?(eventStartMins=30,cell=row.find(".tcell:nth-child("+(parseInt(cellNo)+1)+")").children(".cell-inner:nth-child(2)")):(eventStartMins=0,cell=row.find(".tcell:nth-child("+(parseInt(cellNo)+1)+")").children(".cell-inner:nth-child(1)"));var minsGap,timeGap=parseInt(eventEndHours)-parseInt(eventStartHours);0==timeGap&&(timeGap=1),minsGap=evenEndMins>0&&30>=evenEndMins?cellHeight/2:0,height*=timeGap}else{cell=row.find(".tcell:nth-child("+(parseInt(cellNo)+1)+")").children(".cell-inner");var timeGap=parseInt(eventEndHours)-parseInt(eventStartHours);0==timeGap&&(timeGap=1),height*=timeGap}height="height:"+height+"px;";var id="ca_"+moment(settings.events[arrayIndex].start).unix()+arrayIndex,eventContent="<div class='event-container "+settings.events[arrayIndex]["class"]+"' data-event-duration="+eventDuration+" data-index="+arrayIndex+" data-startTime="+settings.events[arrayIndex].start+" data-endTime="+settings.events[arrayIndex].end+" id="+id+" data-id="+id+" data-row="+parseInt(eventStartHours)+" data-cell="+cellNo+" style="+height+">";eventContent+="<div class='event-inner'>",eventContent+="<div class='event-title'>"+settings.events[arrayIndex].title+"</div>",eventContent+="<div class='time-wrap'><span class='event-start-time'>"+moment(settings.events[arrayIndex].start).format("h:mm")+"</span> - ",eventContent+="<span class='event-end-time'>"+moment(settings.events[arrayIndex].end).format("h:mm")+"</span></div>",eventContent+="</div>",eventContent+="</div>",cell.append(eventContent),this.bindEventDraggers(),settings.events[arrayIndex].dataID=id,$.fn.pagescalendar.settings.onEventRender.call(this)},bindEventDraggers:function(){var previousH,stepper,snapGridWidth=($(".cell-inner").outerHeight()/2,$(".tcell").outerWidth());stepper="30"==settings.slotDuration?30:60,$(".event-container").resizable({handles:"s",minHeight:40,grid:[snapGridWidth,40],start:function(event,ui){previousH=ui.size.height},resize:function(event,ui){if(previousH>ui.size.height){var et=ui.element.attr("data-endtime"),x=moment(et).subtract(stepper,"minutes").format();ui.element.attr("data-endtime",x),ui.element.attr("data-event-duration",parseFloat(ui.element.attr("data-event-duration"))-stepper/60);var elem=ui.element.children(".event-inner").children(".time-wrap").children(".event-end-time");elem.html(moment(x).format("h:mm")),previousH=ui.size.height}else{var et=ui.element.attr("data-endtime"),x=moment(et).add(stepper,"minutes").format();ui.element.attr("data-endtime",x),ui.element.attr("data-event-duration",parseFloat(ui.element.attr("data-event-duration"))+stepper/60);var elem=ui.element.children(".event-inner").children(".time-wrap").children(".event-end-time");elem.html(moment(x).format("h:mm")),previousH=ui.size.height}},stop:function(event,ui){var elem=ui.element,i=elem.attr("data-index");settings.events[i].end=elem.attr("data-endtime");var eventO=helpers.constructEventForUser(i);helpers.setEventBubbles(settings.events),$.fn.pagescalendar.settings.onEventResizeComplete(eventO)}}),$(".cell-inner").sortable({connectWith:".cell-inner",iframeFix:!1,items:".event-container",opacity:.8,helper:"original",grid:[snapGridWidth,40],forceHelperSize:!0,placeholder:"sortable-box-placeholder round-all",forcePlaceholderSize:!0,tolerance:"pointer",greedy:!0,revert:300,over:function(event,ui){var elem=ui.placeholder.parent(".cell-inner"),startTime=elem.attr("data-time-slot"),date=$("#weekViewTableHead .thead .tcell:nth-child("+(elem.parent().index()+1)+")").attr("data-day"),duration=ui.helper.attr("data-event-duration"),endTime=moment(startTime,["h:mm"]).add(duration,"hours").format("h:mm");endTime=moment(date+endTime,"YYYY/MM/D h:mm").format(),date=moment(date+startTime,"YYYY/MM/D h:mm").format(),ui.helper.attr("data-starttime",date),ui.helper.attr("data-endtime",endTime),ui.helper.children(".event-inner").children(".time-wrap").children(".event-start-time").text(moment(ui.helper.attr("data-starttime")).format("h:mm")),ui.helper.children(".event-inner").children(".time-wrap").children(".event-end-time").text(moment(ui.helper.attr("data-endtime")).format("h:mm"))},receive:function(event,ui){var elem=ui.item,i=elem.attr("data-index");settings.events[i].start=elem.attr("data-starttime"),settings.events[i].end=elem.attr("data-endtime");var eventO=helpers.constructEventForUser(i);helpers.setEventBubbles(settings.events),$.fn.pagescalendar.settings.onEventDragComplete(eventO)}})},weekDateChange:function(day,elem){calendar.date=day,this.buildCurrentDateHeader(),this.highlightWeek(elem),this.loadDatesToWeekView(),this.highlightActiveDay(),this.loadEvents(),this.setEventBubbles(settings.events)},timeSlotDblClick:function(obj){var elem=$(obj),h="00";1==elem.index()&&(h="30");var date=moment(calendar.startOfWeekDate).add(elem.parent().index(),"days").format("YYYY/MM/D"),time=moment(elem.parent().parent().index()+":"+h,["H:mm"]).format(" H:mm");date=moment(date+time,"YYYY/MM/D h:mm").format();var timeSlot={date:date};$.fn.pagescalendar.settings.onTimeSlotDblClick(timeSlot)},bindEventHanders:function(){$(document).on("click",".date-selector",function(){$(".week-date").removeClass("active"),$(this).children(".week-date").addClass("active"),helpers.weekDateChange(parseInt($(this).children(".week-date").children(".day").children("a").attr("data-date")),$(this))}),$(document).on("dblclick doubletap",".cell-inner",function(){helpers.timeSlotDblClick(this)}),$(document).on("click",".event-container",function(){var eventO=helpers.constructEventForUser($(this).attr("data-index"));$.fn.pagescalendar.settings.onEventClick(eventO)}),$(".year-selector").on("click",function(){var year=$(this).attr("data-year");calendar.year=moment(year,settings.ui.year.format).year(),helpers.highlightYear(),helpers.renderViewsOnDateChange()}),$(".month-selector").on("click",function(){var month=$(this).attr("data-month");calendar.month=moment(month,settings.ui.month.format).month(),helpers.renderViewsOnDateChange(),helpers.highlightMonth()})},constructEventForUser:function(i){var eventO={index:i,title:settings.events[i].title,"class":settings.events[i]["class"],start:settings.events[i].start,end:settings.events[i].end,allDay:settings.events[i].allDay,other:settings.events[i].other};return eventO},renderViewsOnDateChange:function(){helpers.buildWeek(),helpers.loadDatesToWeekView(),helpers.buildCurrentDateHeader(),this.setEventBubbles(settings.events),helpers.loadEvents()},setLocale:function(){var currentLang=settings.locale;moment.locale(currentLang)},setDate:function(d){calendar.month=moment(d).month(),calendar.year=moment(d).year(),calendar.date=moment(d).format("D"),calendar.dayOfWeek=moment(d).day(),calendar.monthLong=moment(d).format("MMM"),this.checkOptionsAndBuild()},getDate:function(format){return null==format&&(format="MMMM Do YYYY"),moment([calendar.year,calendar.month,calendar.date]).format(format)},getEventArray:function(option){return null==option||"all"==option?settings.events:void 0}};return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error('Method "'+method+'" does not exist in pagescalendar plugin!'):methods.init.apply(this,arguments)},$.fn.pagescalendar.defaults={ui:{year:{visible:!0,format:"YYYY",startYear:"2000",endYear:moment().add(10,"year").format("YYYY"),eventBubble:!0},month:{visible:!0,format:"MMM",eventBubble:!0},date:{format:"MMMM YYYY, D dddd"},week:{day:{format:"D"},header:{format:"dd"},eventBubble:!0,startOfTheWeek:"0",endOfTheWeek:"6"},grid:{dateFormat:"D dddd",timeFormat:"h A",eventBubble:!0,slotDuration:"30"}},header:{visible:!0,dateFormat:"MMM YYYY"},miniCalendar:{visible:!0,highlightWeek:!0,showEventBubbles:!0},eventObj:{editable:!0},now:null,locale:"en",timeFormat:"h a",dateFormat:"MMMM Do YYYY",slotDuration:"30",events:[],onViewRenderComplete:function(){},onEventDblClick:function(){},onEventClick:function(){},onEventRender:function(){},onEventDragComplete:function(){},onEventResizeComplete:function(){},onTimeSlotDblClick:function(){}},$.fn.pagescalendar.defaults.calendar={year:moment().year(),date:moment().format("D"),month:moment().month(),monthLong:"",dayOfWeek:moment().day(),daysOfMonth:0,startOfWeekDate:null,timeFormat:"",loadedYears:{}},$.fn.pagescalendar.settings={}}(jQuery);